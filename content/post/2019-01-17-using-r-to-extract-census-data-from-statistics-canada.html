---
title: Using R To Extract Census Data from Statistics Canada
author: ~
date: '2019-01-17'
slug: using-r-to-extract-census-data-from-statistics-canada
categories:
  - LISPOP
  - R
tags:
  - R
image:
  caption: ''
  focal_point: ''
---



<p>I’ve noticed that Statistics Canada seems to lag other national statistical agencies in making their data available in user friendly formats.</p>
{{% tweet "1085167281532006405" %}}
<p>In my own personal experience, it has been a difficult to get what was seemingly very basic information. By comparison, US census data is readily available in R <em>packages</em> (i.e. <a href="https://cran.r-project.org/web/packages/census/index.html">census</a>, <a href="https://github.com/hrecht/censusapi">censusapi</a>, and <a href="https://cran.r-project.org/web/packages/tidycensus/index.html">tidycensus</a>).</p>
<p>Recently I needed to get some 2016 census data for the city of Toronto and I decided to check in with StatsCan because I had seen some references to new <a href="https://www.statcan.gc.ca/eng/developers">developer services</a>, including <a href="https://www12.statcan.gc.ca/wds-sdw/cpr2016-eng.cfm">cpr2016</a>, a service that returns census data in JSON or XML format. So that got me prety excited.</p>
<p>But, the help documentation is extremely limited.</p>
<p>I fought with it for a day, required some help on stackoverflow and had to reach out to StatsCan’s help desk, <em>but</em> I was able to get what I needed so I thought I would share it here.</p>
<p>The key is constructing a URL to pass a request for particular data to Statistics CAnada. This is the help url that is provided:</p>
<p><code>https://www12.statcan.gc.ca/rest/census-recensement/CPR2016.json?lang=E&amp;dguid=2016A000011124&amp;topic=1&amp;notes=0</code></p>
<p>I tried using <code>rjson::fromJSON()</code> to get it, but ran into this error:</p>
<pre class="r"><code>#Uncomment the following line if you do not have rjson installed. 
#install.packages(&#39;rjson&#39;)
library(rjson)
census_url&lt;-&#39;https://www12.statcan.gc.ca/rest/census-recensement/CPR2016.json?lang=E&amp;dguid=2016A000011124&amp;topic=1&amp;notes=0&#39;
fromJSON(census_url)</code></pre>
<pre><code>## Error in fromJSON(census_url): unexpected character &#39;h&#39;</code></pre>
<p>So, the error message is that there’s an unexpected character ‘h’ somewhere in the file. Which is unfortunate and weird. It’s unfortunate because it shows that somehow R and Statistics Canada are not playing well together right off the top. It’s weird because yesterday, it was returning an unexpected charcter of <code>/</code>.
When I plunked the test URL into a <a href="https://jsonformatter.curiousconcept.com/">JSON validator</a>, it pinpointed two forward slashes at the beginning of the returned output as being errors. When I looked around at how JSON files should be formatted, two forward slashes at the beginning did seem to be …not right.</p>
<p>So, with some help at Stackoverflow, I just figured out a way to remove those characters.</p>
<pre class="r"><code>#Get the output with readlines
tmp&lt;-readLines(census_url)
#Delete the two forward slashes
tmp&lt;-substring(tmp,3)
head(tmp)</code></pre>
<pre><code>## [1] &quot;{\&quot;COLUMNS\&quot;:[\&quot;PROV_TERR_ID\&quot;,\&quot;PROV_TERR_NAME_NOM\&quot;,\&quot;GEO_UID\&quot;,\&quot;GEO_ID\&quot;,\&quot;GEO_NAME_NOM\&quot;,\&quot;GEO_TYPE\&quot;,\&quot;TOPIC_THEME\&quot;,\&quot;TEXT_ID\&quot;,\&quot;HIER_ID\&quot;,\&quot;INDENT_ID\&quot;,\&quot;TEXT_NAME_NOM\&quot;,\&quot;NOTE_ID\&quot;,\&quot;NOTE\&quot;,\&quot;T_DATA_DONNEE\&quot;,\&quot;T_SYM\&quot;,\&quot;M_DATA_DONNEE\&quot;,\&quot;M_SYM\&quot;,\&quot;F_DATA_DONNEE\&quot;,\&quot;F_SYM\&quot;],\&quot;DATA\&quot;:[[\&quot;01\&quot;,\&quot;Canada\&quot;,\&quot;2016A000011124\&quot;,\&quot;01\&quot;,\&quot;Canada\&quot;,null,\&quot;Aboriginal peoples\&quot;,24000,\&quot;6.1.1\&quot;,0,\&quot;Total - Aboriginal identity for the population in private households - 25% sample data\&quot;,79,null,3.4460065E7,null,1.6971575E7,null,1.7488485E7,null],[\&quot;01\&quot;,\&quot;Canada\&quot;,\&quot;2016A000011124\&quot;,\&quot;01\&quot;,\&quot;Canada\&quot;,null,\&quot;Aboriginal peoples\&quot;,24001,\&quot;6.1.1.1\&quot;,1,\&quot;  Aboriginal identity\&quot;,80,null,1673785.0,null,813520.0,null,860265.0,null],[\&quot;01\&quot;,\&quot;Canada\&quot;,\&quot;2016A000011124\&quot;,\&quot;01\&quot;,\&quot;Canada\&quot;,null,\&quot;Aboriginal peoples\&quot;,24002,\&quot;6.1.1.1.1\&quot;,2,\&quot;    Single Aboriginal responses\&quot;,81,null,1629805.0,null,792970.0,null,836835.0,null],[\&quot;01\&quot;,\&quot;Canada\&quot;,\&quot;2016A000011124\&quot;,\&quot;01\&quot;,\&quot;Canada\&quot;,null,\&quot;Aboriginal peoples\&quot;,24003,\&quot;6.1.1.1.1.1\&quot;,3,\&quot;      First Nations (North American Indian)\&quot;,82,null,977235.0,null,471510.0,null,505725.0,null],[\&quot;01\&quot;,\&quot;Canada\&quot;,\&quot;2016A000011124\&quot;,\&quot;01\&quot;,\&quot;Canada\&quot;,null,\&quot;Aboriginal peoples\&quot;,24004,\&quot;6.1.1.1.1.2\&quot;,3,\&quot;      Métis\&quot;,null,null,587545.0,null,289435.0,null,298115.0,null],[\&quot;01\&quot;,\&quot;Canada\&quot;,\&quot;2016A000011124\&quot;,\&quot;01\&quot;,\&quot;Canada\&quot;,null,\&quot;Aboriginal peoples\&quot;,24005,\&quot;6.1.1.1.1.3\&quot;,3,\&quot;      Inuk (Inuit)\&quot;,null,null,65030.0,null,32030.0,null,32995.0,null],[\&quot;01\&quot;,\&quot;Canada\&quot;,\&quot;2016A000011124\&quot;,\&quot;01\&quot;,\&quot;Canada\&quot;,null,\&quot;Aboriginal peoples\&quot;,24006,\&quot;6.1.1.1.2\&quot;,2,\&quot;    Multiple Aboriginal responses\&quot;,83,null,21310.0,null,10165.0,null,11145.0,null],[\&quot;01\&quot;,\&quot;Canada\&quot;,\&quot;2016A000011124\&quot;,\&quot;01\&quot;,\&quot;Canada\&quot;,null,\&quot;Aboriginal peoples\&quot;,24007,\&quot;6.1.1.1.3\&quot;,2,\&quot;    Aboriginal responses not included elsewhere\&quot;,84,null,22670.0,null,10385.0,null,12290.0,null],[\&quot;01\&quot;,\&quot;Canada\&quot;,\&quot;2016A000011124\&quot;,\&quot;01\&quot;,\&quot;Canada\&quot;,null,\&quot;Aboriginal peoples\&quot;,24008,\&quot;6.1.1.2\&quot;,1,\&quot;  Non-Aboriginal identity\&quot;,null,null,3.278628E7,null,1.615806E7,null,1.6628225E7,null],[\&quot;01\&quot;,\&quot;Canada\&quot;,\&quot;2016A000011124\&quot;,\&quot;01\&quot;,\&quot;Canada\&quot;,null,\&quot;Aboriginal peoples\&quot;,24009,\&quot;6.1.2\&quot;,0,\&quot;Total - Population by Registered or Treaty Indian status for the population in private households - 25% sample data\&quot;,85,null,3.4460065E7,null,1.697158E7,null,1.748849E7,null],[\&quot;01\&quot;,\&quot;Canada\&quot;,\&quot;2016A000011124\&quot;,\&quot;01\&quot;,\&quot;Canada\&quot;,null,\&quot;Aboriginal peoples\&quot;,24010,\&quot;6.1.2.1\&quot;,1,\&quot;  Registered or Treaty Indian\&quot;,86,null,820120.0,null,395670.0,null,424445.0,null],[\&quot;01\&quot;,\&quot;Canada\&quot;,\&quot;2016A000011124\&quot;,\&quot;01\&quot;,\&quot;Canada\&quot;,null,\&quot;Aboriginal peoples\&quot;,24011,\&quot;6.1.2.2\&quot;,1,\&quot;  Not a Registered or Treaty Indian\&quot;,null,null,3.3639945E7,null,1.6575905E7,null,1.706404E7,null],[\&quot;01\&quot;,\&quot;Canada\&quot;,\&quot;2016A000011124\&quot;,\&quot;01\&quot;,\&quot;Canada\&quot;,null,\&quot;Aboriginal peoples\&quot;,24012,\&quot;6.1.3\&quot;,0,\&quot;Total - Aboriginal ancestry for the population in private households - 25% sample data\&quot;,87,null,3.4460065E7,null,1.6971575E7,null,1.748849E7,null],[\&quot;01\&quot;,\&quot;Canada\&quot;,\&quot;2016A000011124\&quot;,\&quot;01\&quot;,\&quot;Canada\&quot;,null,\&quot;Aboriginal peoples\&quot;,24013,\&quot;6.1.3.1\&quot;,1,\&quot;  Aboriginal ancestry (only)\&quot;,88,null,727790.0,null,356970.0,null,370815.0,null],[\&quot;01\&quot;,\&quot;Canada\&quot;,\&quot;2016A000011124\&quot;,\&quot;01\&quot;,\&quot;Canada\&quot;,null,\&quot;Aboriginal peoples\&quot;,24014,\&quot;6.1.3.1.1\&quot;,2,\&quot;    Single Aboriginal ancestry (only)\&quot;,89,null,709235.0,null,347985.0,null,361245.0,null],[\&quot;01\&quot;,\&quot;Canada\&quot;,\&quot;2016A000011124\&quot;,\&quot;01\&quot;,\&quot;Canada\&quot;,null,\&quot;Aboriginal peoples\&quot;,24015,\&quot;6.1.3.1.1.1\&quot;,3,\&quot;      First Nations (North American Indian) single ancestry\&quot;,82,null,573215.0,null,280040.0,null,293180.0,null],[\&quot;01\&quot;,\&quot;Canada\&quot;,\&quot;2016A000011124\&quot;,\&quot;01\&quot;,\&quot;Canada\&quot;,null,\&quot;Aboriginal peoples\&quot;,24016,\&quot;6.1.3.1.1.2\&quot;,3,\&quot;      Métis single ancestry\&quot;,null,null,91255.0,null,45740.0,null,45515.0,null],[\&quot;01\&quot;,\&quot;Canada\&quot;,\&quot;2016A000011124\&quot;,\&quot;01\&quot;,\&quot;Canada\&quot;,null,\&quot;Aboriginal peoples\&quot;,24017,\&quot;6.1.3.1.1.3\&quot;,3,\&quot;      Inuit single ancestry\&quot;,null,null,44765.0,null,22210.0,null,22555.0,null],[\&quot;01\&quot;,\&quot;Canada\&quot;,\&quot;2016A000011124\&quot;,\&quot;01\&quot;,\&quot;Canada\&quot;,null,\&quot;Aboriginal peoples\&quot;,24018,\&quot;6.1.3.1.2\&quot;,2,\&quot;    Multiple Aboriginal ancestries (only)\&quot;,90,null,18555.0,null,8985.0,null,9565.0,null],[\&quot;01\&quot;,\&quot;Canada\&quot;,\&quot;2016A000011124\&quot;,\&quot;01\&quot;,\&quot;Canada\&quot;,null,\&quot;Aboriginal peoples\&quot;,24019,\&quot;6.1.3.1.2.1\&quot;,3,\&quot;      First Nations (North American Indian) and Métis ancestries\&quot;,null,null,15140.0,null,7305.0,null,7835.0,null],[\&quot;01\&quot;,\&quot;Canada\&quot;,\&quot;2016A000011124\&quot;,\&quot;01\&quot;,\&quot;Canada\&quot;,null,\&quot;Aboriginal peoples\&quot;,24020,\&quot;6.1.3.1.2.2\&quot;,3,\&quot;      First Nations (North American Indian) and Inuit ancestries\&quot;,null,null,2470.0,null,1205.0,null,1265.0,null],[\&quot;01\&quot;,\&quot;Canada\&quot;,\&quot;2016A000011124\&quot;,\&quot;01\&quot;,\&quot;Canada\&quot;,null,\&quot;Aboriginal peoples\&quot;,24021,\&quot;6.1.3.1.2.3\&quot;,3,\&quot;      Métis and Inuit ancestries\&quot;,null,null,770.0,null,390.0,null,380.0,null],[\&quot;01\&quot;,\&quot;Canada\&quot;,\&quot;2016A000011124\&quot;,\&quot;01\&quot;,\&quot;Canada\&quot;,null,\&quot;Aboriginal peoples\&quot;,24022,\&quot;6.1.3.1.2.4\&quot;,3,\&quot;      First Nations (North American Indian), Métis and Inuit ancestries\&quot;,null,null,170.0,null,85.0,null,85.0,null],[\&quot;01\&quot;,\&quot;Canada\&quot;,\&quot;2016A000011124\&quot;,\&quot;01\&quot;,\&quot;Canada\&quot;,null,\&quot;Aboriginal peoples\&quot;,24023,\&quot;6.1.3.2\&quot;,1,\&quot;  Aboriginal and non-Aboriginal ancestries\&quot;,91,null,1402735.0,null,669710.0,null,733025.0,null],[\&quot;01\&quot;,\&quot;Canada\&quot;,\&quot;2016A000011124\&quot;,\&quot;01\&quot;,\&quot;Canada\&quot;,null,\&quot;Aboriginal peoples\&quot;,24024,\&quot;6.1.3.2.1\&quot;,2,\&quot;    Single Aboriginal and non-Aboriginal ancestries\&quot;,92,null,1347610.0,null,644210.0,null,703400.0,null],[\&quot;01\&quot;,\&quot;Canada\&quot;,\&quot;2016A000011124\&quot;,\&quot;01\&quot;,\&quot;Canada\&quot;,null,\&quot;Aboriginal peoples\&quot;,24025,\&quot;6.1.3.2.1.1\&quot;,3,\&quot;      First Nations (North American Indian) and non-Aboriginal ancestries\&quot;,null,null,881455.0,null,418215.0,null,463235.0,null],[\&quot;01\&quot;,\&quot;Canada\&quot;,\&quot;2016A000011124\&quot;,\&quot;01\&quot;,\&quot;Canada\&quot;,null,\&quot;Aboriginal peoples\&quot;,24026,\&quot;6.1.3.2.1.2\&quot;,3,\&quot;      Métis and non-Aboriginal ancestries\&quot;,null,null,441000.0,null,213940.0,null,227065.0,null],[\&quot;01\&quot;,\&quot;Canada\&quot;,\&quot;2016A000011124\&quot;,\&quot;01\&quot;,\&quot;Canada\&quot;,null,\&quot;Aboriginal peoples\&quot;,24027,\&quot;6.1.3.2.1.3\&quot;,3,\&quot;      Inuit and non-Aboriginal ancestries\&quot;,null,null,25155.0,null,12045.0,null,13105.0,null],[\&quot;01\&quot;,\&quot;Canada\&quot;,\&quot;2016A000011124\&quot;,\&quot;01\&quot;,\&quot;Canada\&quot;,null,\&quot;Aboriginal peoples\&quot;,24028,\&quot;6.1.3.2.2\&quot;,2,\&quot;    Multiple Aboriginal and non-Aboriginal ancestries\&quot;,93,null,55125.0,null,25505.0,null,29625.0,null],[\&quot;01\&quot;,\&quot;Canada\&quot;,\&quot;2016A000011124\&quot;,\&quot;01\&quot;,\&quot;Canada\&quot;,null,\&quot;Aboriginal peoples\&quot;,24029,\&quot;6.1.3.2.2.1\&quot;,3,\&quot;      First Nations (North American Indian), Métis and non-Aboriginal ancestries\&quot;,null,null,49325.0,null,22740.0,null,26585.0,null],[\&quot;01\&quot;,\&quot;Canada\&quot;,\&quot;2016A000011124\&quot;,\&quot;01\&quot;,\&quot;Canada\&quot;,null,\&quot;Aboriginal peoples\&quot;,24030,\&quot;6.1.3.2.2.2\&quot;,3,\&quot;      First Nations (North American Indian), Inuit and non-Aboriginal ancestries\&quot;,null,null,3470.0,null,1655.0,null,1815.0,null],[\&quot;01\&quot;,\&quot;Canada\&quot;,\&quot;2016A000011124\&quot;,\&quot;01\&quot;,\&quot;Canada\&quot;,null,\&quot;Aboriginal peoples\&quot;,24031,\&quot;6.1.3.2.2.3\&quot;,3,\&quot;      Métis, Inuit and non-Aboriginal ancestries\&quot;,null,null,2005.0,null,940.0,null,1065.0,null],[\&quot;01\&quot;,\&quot;Canada\&quot;,\&quot;2016A000011124\&quot;,\&quot;01\&quot;,\&quot;Canada\&quot;,null,\&quot;Aboriginal peoples\&quot;,24032,\&quot;6.1.3.2.2.4\&quot;,3,\&quot;      First Nations (North American Indian), Métis, Inuit and non-Aboriginal ancestries\&quot;,null,null,325.0,null,170.0,null,160.0,null],[\&quot;01\&quot;,\&quot;Canada\&quot;,\&quot;2016A000011124\&quot;,\&quot;01\&quot;,\&quot;Canada\&quot;,null,\&quot;Aboriginal peoples\&quot;,24033,\&quot;6.1.3.3\&quot;,1,\&quot;  Non-Aboriginal ancestry (only)\&quot;,94,null,3.2329545E7,null,1.59449E7,null,1.6384645E7,null]]}&quot;</code></pre>
<p>Now, I won’t print the results here, because it looks messy, but it does work.</p>
<pre class="r"><code>#Get from RJSON
out&lt;-fromJSON(tmp)
#structure
str(out)</code></pre>
<p>Now, it still looks like a pretty messy file, and I’m not going to lie, I don’t understand how to extract the data I need from this, but it does appear to be some progress.</p>
<p>The trick is finding out what the geographic codes are to get the data you need.</p>
<p>According to the help page, you can search for geocodes using <em>another</em> URL:
<code>https://www12.statcan.gc.ca/rest/censusapp/CensusGeoService.json?lang={lang}&amp;geolevel={geolevel}¬es={notes}</code></p>
<p>But, like I said, it’s extremely confusing about how to actually use that, and I had to turn to StatsCan’s help to get Toronto’s URL.</p>
<p>For future reference, this is the URL for the city of Toronto 2016 census profile.
<code>https://www12.statcan.gc.ca/census-recensement/2016/dp-pd/prof/details/page.cfm?Lang=E&amp;Geo1=CSD&amp;Code1=3520005&amp;Geo2=CD&amp;Code2=3520&amp;Data=Count&amp;SearchText=3520005&amp;SearchType=Begins&amp;SearchPR=01&amp;B1=All&amp;TABID=3</code></p>
